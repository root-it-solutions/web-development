tribe.tickets=tribe.tickets||{},tribe.tickets.admin=tribe.tickets.admin||{},tribe.dialogs=tribe.dialogs||{},tribe.dialogs.events=tribe.dialogs.events||{},tribe.tickets.admin.commerceSettings={},function(t,e,n){const o=t(document);n.selectors={connectButton:"#js-give-paypal-on-boarding-handler",connectButtonWrap:".connect-button-wrap",connectionSettingContainer:"#give-paypal-commerce-account-manager-field-wrap .connection-setting",container:"#tribe-field-tickets-commerce-paypal-commerce-configure",countrySelect:"#tickets-commerce-paypal-commerce-account-country-select",errorMessageTemplate:".paypal-message-template",disconnectionSettingContainer:"#give-paypal-commerce-account-manager-field-wrap .disconnection-setting",disconnectPayPalAccountButton:"#js-give-paypal-disconnect-paypal-account",troubleNotice:"#give-paypal-onboarding-trouble-notice",webHookSetUpLink:"#tec-tickets__admin-settings-webhook-set-up"},n.observePayPalModal=function(){n.paypalErrorQuickHelp=t(n.selectors.troubleNotice),new MutationObserver((function(t){t.forEach((function(t){t.removedNodes.forEach((function(t){"PPMiniWin"===t.getAttribute("id")&&n.paypalErrorQuickHelp[0]&&n.paypalErrorQuickHelp.removeClass("tribe-common-a11y-hidden")}))}))})).observe(document.querySelector("body"),{attributes:!0,childList:!0})},n.maybeShowModalAfterConnection=function(){(window.location.search.match(/tc-status=paypal-signup-complete/i)||window.location.search.match(/tc-status=stripe-signup-complete/i))&&tribe.dialogs.dialogs.forEach((function(e){"paypal-connected-modal-id"===e.id&&e.a11yInstance.show(),"stripe-connected-modal-id"===e.id&&e.a11yInstance.show(),e.a11yInstance.node.querySelectorAll('[data-js="a11y-close-button"]').forEach((function(n){t(n).on("click",(function(){e.a11yInstance.hide()}))}))}))},n.setupPartnerLink=function(t){const e=document.querySelector("[data-paypal-button]");e.href=t+"&displayMode=minibrowser",e.click(),n.observePayPalModal()},n.requestPartnerUrl=function(t){fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_get_partner_url&country_code="+t).then((function(t){return t.json()})).then((function(t){!0===t.success&&n.setupPartnerLink(t.data.partnerLink),n.buttonState.enable()})).then((function(){fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_onboarding_trouble_notice").then((function(t){return t.json()})).then((function(t){if(!0!==t.success)return;const e=document.querySelector(n.selectors.connectButtonWrap);n.paypalErrorQuickHelp[0]&&n.paypalErrorQuickHelp.remove(),e.append(function(t){const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}(t.data))}))}))},n.removeErrors=function(){const t=document.querySelector(n.selectors.errorMessageTemplate);t&&t.parentElement.remove()},n.buttonState={enable(){n.onBoardingButton.attr("disabled",!1),n.onBoardingButton.text(n.onBoardingButton.data("initial-label"))},disable(){n.onBoardingButton.data("initial-label")||n.onBoardingButton.data("initial-label",n.onBoardingButton.text().trim()),n.onBoardingButton.attr("disabled",!0),n.onBoardingButton.text("Processing text here")}},n.handleConnectClick=function(e){e.preventDefault(),n.removeErrors();const o=t(n.selectors.countrySelect).val();n.buttonState.disable(),n.paypalErrorQuickHelp=t(n.selectors.troubleNotice),n.paypalErrorQuickHelp[0]&&n.paypalErrorQuickHelp.addClass("tribe-common-a11y-hidden"),n.requestPartnerUrl(o)},n.handleDisconnectClick=function(e){e.preventDefault(),n.removeErrors(),t(n.selectors.connectionSettingContainer).removeClass("tribe-common-a11y-hidden"),t(n.selectors.disconnectionSettingContainer).addClass("tribe-common-a11y-hidden"),fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_disconnect_account")},n.onBoardCallback=function(e,o){fetch(ajaxurl+"?action=tribe_tickets_paypal_commerce_user_on_boarded&authCode="+e+"&sharedId="+o).then((function(t){return t.json()})).then((function(e){!0===e.success?(n.paypalErrorQuickHelp=t(n.selectors.troubleNotice),n.paypalErrorQuickHelp[0]&&n.paypalErrorQuickHelp.remove()):alert("Something went wrong while we were connecting your account, please try again.")}))},n.onWebHookSetUpLinkClick=function(e){e.preventDefault();const n=t(e.target);o.find("#tec-tickets-webhook-creation-update").remove(),t(`<p id="tec-tickets-webhook-creation-update" class="tooltip description">\n\t\t\t<span class="dashicons dashicons-update"></span>\n\t\t\t<span>${n.attr("data-loading-text")}</span>\n\t\t\t</p>`).insertAfter(n.closest("p")),fetch(n.attr("href")).then((function(t){return t.json()})).then((function(e){const n=t("#tec-tickets-webhook-creation-update"),o=n.find("span.dashicons");n.find("span:not(.dashicons)").text(e.data.status),o.removeClass("dashicons-update"),!0===e.success?(o.addClass("dashicons-yes"),setTimeout((function(){window.location.reload()}),700)):o.addClass("dashicons-no")}))},n.ready=function(){n.onBoardingButton=t(n.selectors.connectButton),n.disconnectButton=t(n.selectors.disconnectPayPalAccountButton),n.setUpWebhookLink=t(n.selectors.webHookSetUpLink),n.onBoardingButton[0]&&n.onBoardingButton.on("click",n.handleConnectClick),n.disconnectButton[0]&&n.disconnectButton.on("click",n.handleDisconnectClick),n.setUpWebhookLink[0]&&n.setUpWebhookLink.on("click",n.onWebHookSetUpLinkClick),n.maybeShowModalAfterConnection()},o.ready(n.ready)}(jQuery,window.underscore||window._,tribe.tickets.admin.commerceSettings),window.tec=window.tec||{},window.tec.tickets=window.tec.tickets||{},window.tec.tickets.admin=window.tec.tickets.admin||{},window.tec.tickets.admin.ticketsCommerceSettings={};